# üéØ TRADia Platform - Guia Completo de Setup

## üìã **O que foi criado para voc√™:**

### ‚úÖ **Estrutura Completa do Projeto**
- üìÅ **TRADia/** como diret√≥rio principal
- üóÑÔ∏è **Schema de banco** seguindo padr√£o TOIT 
- ‚öôÔ∏è **CI/CD** com GitHub Actions (3 ambientes)
- üê≥ **Docker Compose** para desenvolvimento
- ‚òÅÔ∏è **Railway.toml** configurado para deploy
- üîß **Scripts automatizados** de setup

### ‚úÖ **Configura√ß√µes de Ambiente**
- üîê **3 ambientes:** dev, test, main
- üöÄ **Deploy autom√°tico:** push na branch = deploy
- üìä **Monitoramento** e health checks
- üõ°Ô∏è **Seguran√ßa** com JWT, rate limiting, CORS

### ‚úÖ **Banco de Dados Padronizado**
- üèóÔ∏è **Esquema TOIT** com campos obrigat√≥rios
- üë• **Tabela usuarios** compat√≠vel com portal
- üìà **Tabelas espec√≠ficas** TRADia (signals, positions, etc.)
- üîÑ **Migrations** e seeds automatizados

---

## üöÄ **PR√ìXIMOS PASSOS - SIGA ESTA ORDEM:**

### **1. Configurar Reposit√≥rio GitHub** 
```bash
# No diret√≥rio TRADia
git init
git add .
git commit -m "üéâ Initial TRADia Platform setup"

# Conectar ao seu reposit√≥rio
git remote add origin https://github.com/victorcalife/TRADia.git
git branch -M main
git push -u origin main

# Criar branches de desenvolvimento
git checkout -b dev
git push -u origin dev

git checkout -b test  
git push -u origin test

git checkout dev  # Voltar para dev para desenvolvimento
```

### **2. Configurar Railway (Dentro do Projeto TOIT Existente)**

#### **üéØ OP√á√ÉO A: Usar Projeto TOIT Existente (RECOMENDADO)**

Se voc√™ j√° tem um projeto TOIT no Railway com PostgreSQL e Redis:

```bash
# Conectar ao projeto TOIT existente
railway link

# Adicionar apenas o servi√ßo TRADia ao projeto existente
railway service new tradia-dev
railway service new tradia-test  
railway service new tradia-prod

# Configurar dom√≠nios
railway domain add tradia-dev.up.railway.app --service tradia-dev
railway domain add tradia-test.up.railway.app --service tradia-test
railway domain add tradia.up.railway.app --service tradia-prod
```

**‚úÖ Vantagens:**
- Reutiliza PostgreSQL e Redis existentes
- Banco de dados √∫nico para todos os sistemas TOIT
- Economia de recursos e custos
- Integra√ß√£o natural entre sistemas

#### **üîÑ OP√á√ÉO B: Projeto Separado (Caso necessite isolamento)**

```bash
cd TRADia
railway project new tradia-platform

# Criar servi√ßos completos
railway service new postgres-dev
railway service new redis-dev  
railway service new tradia-dev
# ... resto dos servi√ßos
```

#### **üéØ Configura√ß√£o para Projeto TOIT Existente:**

**Vari√°veis de Ambiente (usando banco existente):**
```bash
# Para cada servi√ßo TRADia (dev/test/prod)
NODE_ENV=development
DATABASE_URL=${{Postgres.DATABASE_URL}}  # Mesmo banco do projeto TOIT
REDIS_URL=${{Redis.REDIS_URL}}           # Mesmo Redis do projeto TOIT
JWT_SECRET=sua-chave-secreta-tradia
FRONTEND_URL=https://tradia-dev.up.railway.app

# Configura√ß√µes espec√≠ficas TRADia
TRADIA_DATABASE_SCHEMA=tradia_dev  # Schema separado no mesmo banco
TRADIA_REDIS_PREFIX=tradia:dev:     # Prefix para separar cache
```

### **3. Configurar Vari√°veis de Ambiente no Railway**

#### **üéØ Para Projeto TOIT Existente:**

Para cada servi√ßo TRADia (tradia-dev, tradia-test, tradia-prod):

**Reutilizando Infraestrutura TOIT:**
```
NODE_ENV=development (ou test/production)
DATABASE_URL=${{Postgres.DATABASE_URL}}     # Mesmo banco do projeto TOIT
REDIS_URL=${{Redis.REDIS_URL}}             # Mesmo Redis do projeto TOIT
JWT_SECRET=sua-chave-secreta-tradia-unica
FRONTEND_URL=https://tradia-dev.up.railway.app

# Separa√ß√£o por schema/prefix
TRADIA_DATABASE_SCHEMA=tradia_dev
TRADIA_REDIS_PREFIX=tradia:dev:
TRADIA_TABLE_PREFIX=tradia_

# APIs espec√≠ficas TRADia
WHATSAPP_API_KEY=sua-chave-whatsapp
EMAIL_API_KEY=sua-chave-email
```

#### **üîÑ Para Projeto Separado:**

```
NODE_ENV=development
DATABASE_URL=${{Postgres_TRADia_Dev.DATABASE_URL}}  # Banco dedicado
REDIS_URL=${{Redis_TRADia_Dev.REDIS_URL}}          # Redis dedicado
JWT_SECRET=sua-chave-secreta-unica
FRONTEND_URL=https://tradia-dev.up.railway.app
```

### **4. Configurar Secrets no GitHub**

No seu reposit√≥rio GitHub, v√° em Settings > Secrets and variables > Actions:

```
RAILWAY_TOKEN_DEV=token-do-railway-dev
RAILWAY_TOKEN_TEST=token-do-railway-test  
RAILWAY_TOKEN_PROD=token-do-railway-prod
SLACK_WEBHOOK_URL=seu-webhook-slack (opcional)
```

### **5. Desenvolvimento Local** 

```bash
# Copiar configura√ß√£o de ambiente
cp .env.example .env

# Editar .env com suas configura√ß√µes
nano .env  # ou use VS Code

# Dar permiss√£o aos scripts
chmod +x setup.sh start-dev.sh stop-dev.sh

# Executar setup automatizado
./setup.sh

# Ou manualmente:
docker-compose up -d postgres redis  # Bancos
npm install                          # Depend√™ncias
npm run dev                         # Desenvolvimento
```

### **6. Testar Deploy Autom√°tico**

```bash
# Fazer uma altera√ß√£o simples
echo "console.log('Testing CI/CD')" >> backend/src/test.js

# Commit e push para dev
git add .
git commit -m "üß™ Testing CI/CD pipeline"
git push origin dev

# ‚úÖ Isso vai automaticamente fazer deploy para tradia-dev.up.railway.app
```

### **7. Pipeline de Deploy Completo**

```bash
# Desenvolvimento
git checkout dev
# fazer altera√ß√µes
git push origin dev  # ‚úÖ Auto-deploy para DEV

# Testing  
git checkout test
git merge dev
git push origin test  # ‚úÖ Auto-deploy para TEST

# Production
git checkout main  
git merge test
git push origin main  # ‚úÖ Auto-deploy para PROD
```

---

## üèóÔ∏è **Estrutura dos Servi√ßos no Railway**

### **üéØ OP√á√ÉO A: Integrado ao Projeto TOIT (RECOMENDADO)**

```
üì¶ projeto-toit/
‚îú‚îÄ‚îÄ üóÑÔ∏è postgres         ‚Üí Banco compartilhado (portal + tradia)
‚îú‚îÄ‚îÄ üî¥ redis            ‚Üí Cache compartilhado
‚îú‚îÄ‚îÄ üåê portal-dev       ‚Üí Portal TOIT desenvolvimento
‚îú‚îÄ‚îÄ üåê portal-test      ‚Üí Portal TOIT testes
‚îú‚îÄ‚îÄ üåê portal-prod      ‚Üí Portal TOIT produ√ß√£o
‚îú‚îÄ‚îÄ ÔøΩ tradia-dev       ‚Üí TRADia desenvolvimento (NOVO)
‚îú‚îÄ‚îÄ ÔøΩ tradia-test      ‚Üí TRADia testes (NOVO)
‚îî‚îÄ‚îÄ ÔøΩ tradia-prod      ‚Üí TRADia produ√ß√£o (NOVO)
```

**‚úÖ Vantagens:**
- **Compartilha infraestrutura** (PostgreSQL + Redis)
- **Usu√°rios unificados** entre portal e TRADia
- **Custos reduzidos** (menos recursos)
- **Backup √∫nico** para todos os sistemas
- **Integra√ß√£o natural** entre sistemas TOIT

### **üîÑ OP√á√ÉO B: Projeto Separado**

```
üì¶ projeto-toit/          üì¶ tradia-platform/
‚îú‚îÄ‚îÄ üóÑÔ∏è postgres         ‚îú‚îÄ‚îÄ ÔøΩÔ∏è postgres-dev
‚îú‚îÄ‚îÄ üî¥ redis            ‚îú‚îÄ‚îÄ üóÑÔ∏è postgres-test  
‚îú‚îÄ‚îÄ üåê portal-*         ‚îú‚îÄ‚îÄ üóÑÔ∏è postgres-prod
                        ‚îú‚îÄ‚îÄ üî¥ redis-dev
                        ‚îú‚îÄ‚îÄ üî¥ redis-test
                        ‚îú‚îÄ‚îÄ üî¥ redis-prod
                        ‚îú‚îÄ‚îÄ ÔøΩ tradia-dev
                        ‚îú‚îÄ‚îÄ üìä tradia-test
                        ‚îî‚îÄ‚îÄ üìä tradia-prod
```

### **URLs dos Ambientes:**
- **Dev:** https://tradia-dev.up.railway.app
- **Test:** https://tradia-test.up.railway.app  
- **Prod:** https://tradia.up.railway.app

---

## üîß **Comandos √öteis**

### **Desenvolvimento Local:**
```bash
./start-dev.sh          # Iniciar tudo
./stop-dev.sh           # Parar tudo
npm run dev             # S√≥ aplica√ß√£o
docker-compose up -d    # S√≥ bancos
```

### **Railway:**
```bash
railway logs --service tradia-dev     # Ver logs
railway connect postgres-dev          # Conectar banco
railway run "npm run db:migrate"      # Executar comando
railway up --service tradia-dev       # Deploy manual
```

### **Banco de Dados:**
```bash
# Local
npm run db:migrate  # Executar migrations
npm run db:seed     # Popular dados

# Railway
railway run "npm run db:migrate" --service tradia-dev
railway run "npm run db:seed" --service tradia-dev
```

---

## üìä **Schema de Banco Compat√≠vel com TOIT**

### **Tabela Usu√°rios (Compat√≠vel com Portal):**
```sql
tradia_users:
‚îú‚îÄ‚îÄ id, tenant_id, created_at, updated_at  # Padr√£o TOIT
‚îú‚îÄ‚îÄ perfil, model, aplicacao, contexto     # Padr√£o TOIT
‚îú‚îÄ‚îÄ email, cpf, password_hash, name, phone # Login padr√£o
‚îú‚îÄ‚îÄ capital_inicial, capital_atual         # TRADia espec√≠fico
‚îú‚îÄ‚îÄ subscription_plan, risk_profile        # TRADia espec√≠fico
‚îî‚îÄ‚îÄ total_return, win_rate, sharpe_ratio   # Performance
```

### **Tabelas Espec√≠ficas TRADia:**
- ‚úÖ `tradia_signals` - Sinais gerados pela IA
- ‚úÖ `tradia_positions` - Posi√ß√µes dos usu√°rios  
- ‚úÖ `tradia_performance` - M√©tricas de performance
- ‚úÖ `tradia_notifications` - Notifica√ß√µes enviadas
- ‚úÖ `tradia_subscriptions` - Planos e billing
- ‚úÖ `tradia_backtests` - Resultados de backtests
- ‚úÖ `tradia_market_data` - Cache de dados de mercado

---

## üéØ **Checklist Final**

### **Antes de Come√ßar:**
- [ ] ‚úÖ **Reposit√≥rio GitHub** criado e conectado
- [ ] ‚úÖ **Railway** conectado ao projeto TOIT existente
- [ ] ‚úÖ **3 servi√ßos TRADia** criados no projeto TOIT
- [ ] ‚úÖ **Vari√°veis ambiente** configuradas (reutilizando banco TOIT)
- [ ] ‚úÖ **Secrets GitHub** configurados para CI/CD
- [ ] ‚úÖ **Desenvolvimento local** funcionando

### **Para Ir Live:**
- [ ] üîÑ **APIs externas** configuradas (WhatsApp, Email)
- [ ] üîÑ **Dom√≠nio customizado** (opcional)
- [ ] üîÑ **SSL/HTTPS** configurado
- [ ] üîÑ **Monitoramento** e alertas
- [ ] üîÑ **Backup** automatizado

---

## üÜò **Suporte e D√∫vidas**

### **Logs e Debug:**
```bash
# Logs locais
docker-compose logs -f
npm run dev 2>&1 | tee debug.log

# Logs Railway  
railway logs --service tradia-dev

# Health check
curl https://tradia-dev.up.railway.app/health
```

### **Problemas Comuns:**
1. **Build falha:** Verificar logs do GitHub Actions
2. **Banco n√£o conecta:** Verificar DATABASE_URL 
3. **CI/CD n√£o roda:** Verificar secrets do GitHub
4. **Deploy falha:** Verificar vari√°veis do Railway

---

## üöÄ **Sua Plataforma Estar√° Assim:**

```
üåç https://tradia.up.railway.app
‚îú‚îÄ‚îÄ üìä Dashboard com sinais em tempo real
‚îú‚îÄ‚îÄ üí∞ Gest√£o de capital pelo usu√°rio
‚îú‚îÄ‚îÄ üìà Performance tracking autom√°tico  
‚îú‚îÄ‚îÄ üì± Notifica√ß√µes WhatsApp/Email
‚îú‚îÄ‚îÄ ü§ñ IA gerando sinais 24/7
‚îî‚îÄ‚îÄ üìã Relat√≥rios de performance
```

**üéâ Vamos come√ßar? Siga o passo 1 e vamos colocar sua TRADia no ar!**
